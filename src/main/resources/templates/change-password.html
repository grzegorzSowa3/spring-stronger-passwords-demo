<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
    <title>Spring Security Reset Password Example </title>
</head>
<body>
<form id="form">
    <label> new password: <input type="password" name="password"/> </label>
    <input type="hidden" name="token" th:value="${param.token}">
    <input id="submit" type="button" name="submit" value="submit">
</form>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>
    $(document).ready(function(){
        $("#submit").on('click', function(){
            console.log("onSubmit");
            $.ajax({
                url: "/change-password",
                type : "POST",
                data : JSON.stringify(getFormData($("#form"))),
                contentType: 'application/json',
                success : function(result) {
                    console.log("success");
                    window.location.replace("/login");
                }
            })
        });
    });
    function getFormData($form){
        var unindexed_array = $form.serializeArray();
        var indexed_array = {};

        $.map(unindexed_array, function(n, i){
            indexed_array[n['name']] = n['value'];
        });

        return indexed_array;
    }
</script>
</body>
</html>
